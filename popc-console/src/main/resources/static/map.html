<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=uft-8" />


  <style type="text/css">
    html,body{margin:0;padding:0;}
    .iw_poi_title {color:#CC5522;font-size:14px;font-weight:bold;overflow:hidden;padding-right:13px;white-space:nowrap}
    .iw_poi_content {font:12px arial,sans-serif;overflow:visible;padding-top:4px;white-space:-moz-pre-wrap;word-wrap:break-word}
  </style>
  <script type="text/javascript" src="http://api.map.baidu.com/api?key=&v=1.1&services=true"></script>
  <!-- jQuery 3.1.1 -->
  <script src="jquery-3.1.1.min.js"></script>

</head>

<body>
<button size="small" type="primary" onClick="doClick()">统计</button>
<button size="small" type="primary" onClick="gotoFeedback('total','沁园春小区','')">明细</button>
<!--百度地图容器-->
<!--<div style="width:1600px;height:800px;border:#ccc solid 1px;" id="dituContent"></div>-->
<div style="width:1600px;height:800px;border:#ccc solid 1px;"> <iframe width="100%" height="100%"  scrolling="yes" src="http://50.120.80.244/risk/"></iframe></div>
<!--<div style="width:1600px;height:800px;border:#ccc solid 1px;"> <iframe width="100%" height="100%"  scrolling="yes" src="http://popc.jd.com/risk/"></iframe></div>-->

</body>
<script type="text/javascript">
    // //创建和初始化地图函数：
    // function initMap(){
    //     createMap();//创建地图
    //     setMapEvent();//设置地图事件
    //     addMapControl();//向地图添加控件
    // }
    //
    // //创建地图函数：
    // function createMap(){
    //     var map = new BMap.Map("dituContent");//在百度地图容器中创建一个地图
    //     var point = new BMap.Point(118.281575,33.96775);//定义一个中心点坐标
    //     map.centerAndZoom(point,13);//设定地图的中心点和坐标并将地图显示在地图容器中
    //     window.map = map;//将map变量存储在全局
    // }
    //
    // //地图事件设置函数：
    // function setMapEvent(){
    //     map.enableDragging();//启用地图拖拽事件，默认启用(可不写)
    //     map.enableScrollWheelZoom();//启用地图滚轮放大缩小
    //     map.enableDoubleClickZoom();//启用鼠标双击放大，默认启用(可不写)
    //     map.enableKeyboard();//启用键盘上下左右键移动地图
    // }
    //
    // //地图控件添加函数：
    // function addMapControl(){
    //     //向地图中添加缩放控件
    //     var ctrl_nav = new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE});
    //     map.addControl(ctrl_nav);
    //     //向地图中添加缩略图控件
    //     var ctrl_ove = new BMap.OverviewMapControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,isOpen:1});
    //     map.addControl(ctrl_ove);
    //     //向地图中添加比例尺控件
    //     var ctrl_sca = new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});
    //     map.addControl(ctrl_sca);
    // }
    //
    //
    // initMap();//创建和初始化地图

    //
    const config = {
        // LOCAL: 'http://popc.jd.com'
        LOCAL: 'http://50.120.80.244'
    }

    function doClick(){

        let communityName="沁园春小区"
        let apartmentNum=null

        iccAjaxRequest(config.LOCAL+"/system/summary/mapCount",{"communityName":communityName,"apartmentNum":apartmentNum} ,function(r){
            if(r.code==200){
                let mapCount=r.data
                //房屋总数
                let  total=mapCount.total

                //自住套数
                let  self=mapCount.self

                //出租套数
                let  rent=mapCount.rent

                //空置套数
                let  empty=mapCount.empty

                //待核套数
                let  todo=mapCount.todo

                //人口总数
                let  today=mapCount.today

                //常住人口
                let  todayNumber=mapCount.todayNumber

                //暂住人口
                let  todayNumber2=mapCount.todayNumber2

                //寄住人口
                let  todayNumber3=mapCount.todayNumber3

                //其他人口
                let  todayNumber4=mapCount.todayNumber4

                alert("房屋总数:"+total+" 自住套数:"+self+" 出租套数:"+rent);

            }else{
                alert("获取统计信息失败!");
            }
        });
    }



    function gotoFeedback(type,communityName,apartmentNum) {

        let params= {
            type: type,
            communityName: communityName,
            apartmentNum: apartmentNum,
        }
        let url = '/system/summary/mapCount/mapPage?' + dealGetParams(params)
        window.open(url)
    }













    //ajax请求
    function iccAjaxRequest(url, data,fun){
        $.ajax({
            url:url,
            type:"get",
            data: data,
            contentType:'application/json;charset=UTF-8',
            success:function(data){
                fun(data)
            },
            error:function(req){

            }
        });
    }
    function dealGetParams(obj) {
        let arr = []
        if (obj instanceof Object) {
            Object.keys(obj).forEach(item => {
                arr.push(`${item}=${obj[item]}`)
            })
        }
        return arr.join('&')+"&"
    }
</script>
</html>
